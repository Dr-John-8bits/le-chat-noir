<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Webradio — Le Chat Noir</title>
  <meta name="description" content="Le Chat Noir — Webradio libre : créations sonores, field recordings, expérimentations radiophoniques, musiques ouvertes et archives vivantes. Sans SACEM, 24/7." />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet" />
  <style>
    :root{
      --night-0:#000000; --night-1:#05060a; --night-2:#0a0b10;
      --accent:#ff7a18; --accent-2:#ff3d00; --accent-3:#ffd761;
    }
    html,body{height:100%;}
    body{
      margin:0; color:#e9f1ff;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica Neue, Arial, Noto Sans, Liberation Sans, sans-serif;
      background:
        radial-gradient(1200px 900px at 50% -30%, rgba(255,255,255,.04) 0%, transparent 60%),
        radial-gradient(1200px 900px at 50% 130%, rgba(255,255,255,.03) 0%, transparent 60%),
        linear-gradient(180deg, var(--night-2), var(--night-1) 40%, var(--night-0));
      overflow-x:hidden;
    }

    /* Canvas starfield layer */
    #starfieldCanvas{ position:fixed; inset:0; width:100%; height:100%; z-index:0; display:block; }

    /* Navbar */
    .navbar-custom{ background: rgba(6,9,20,.45); border-bottom:1px solid rgba(255,255,255,.06); }

    /* Wave divider */
    .wave-divider{ height:14px; margin:24px auto; max-width:780px; opacity:.7;
      background: repeating-linear-gradient(90deg, transparent 0 6px, rgba(255,255,255,.06) 6px 7px),
                  linear-gradient(90deg, var(--accent), var(--accent-2) 50%, var(--accent-3));
      border-radius:6px; filter: blur(.3px);
    }

    main{ position:relative; z-index:2; }
    .cover{ border-radius:20px; overflow:visible; box-shadow:none; background:transparent; }
    .cover img{ display:block; width:50%; height:auto; object-fit:cover; margin:auto; border-radius:12px; }
    .badge-tag{ background:rgba(0,0,0,.55); color:#eaf2ff; border:1px solid rgba(255,255,255,.18); padding:.35rem .6rem; border-radius:999px; font-size:.8rem; }
    .btn-ghost{ --bs-btn-border-color: rgba(255,255,255,.35); --bs-btn-color:#e9f1ff; --bs-btn-hover-bg: rgba(255,255,255,.08); }

    /* Faux player (glass card) */
    .player-card{ background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.14); border-radius:16px; backdrop-filter: blur(6px); padding:14px 16px; }
    .player-header{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .onair{ display:inline-flex; align-items:center; gap:8px; font-size:.85rem; color:#ffd761; }
    .onair .dot{ width:8px; height:8px; border-radius:50%; background:#ff3d00; box-shadow:0 0 0 0 rgba(255,61,0,.7); animation:pulseDot 1.6s infinite; }
    @keyframes pulseDot{ 0%{ box-shadow:0 0 0 0 rgba(255,61,0,.7);} 70%{ box-shadow:0 0 0 8px rgba(255,61,0,0);} 100%{ box-shadow:0 0 0 0 rgba(255,61,0,0);} }
    .player-body{ display:flex; align-items:center; gap:12px; margin-top:10px; }
    .player-btn{ width:44px; height:44px; border-radius:50%; border:1px solid rgba(255,255,255,.25); background:transparent; color:#e9f1ff; display:inline-flex; align-items:center; justify-content:center; }
    .vol-group{ display:flex; align-items:center; gap:8px; margin-left:4px; }
    .vol-btn{ width:36px; height:36px; border-radius:50%; border:1px solid rgba(255,255,255,.25); background:transparent; color:#e9f1ff; display:inline-flex; align-items:center; justify-content:center; font-size:.9rem; }
    .vol-range{ -webkit-appearance:none; appearance:none; width:110px; height:4px; background:rgba(255,255,255,.18); border-radius:999px; outline:none; }
    .vol-range::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:16px; height:16px; border-radius:50%; background:#ffd761; border:1px solid rgba(0,0,0,.25); cursor:pointer; box-shadow:0 0 0 4px rgba(255,215,97,.18); }
    .vol-range::-moz-range-thumb{ width:16px; height:16px; border-radius:50%; background:#ffd761; border:1px solid rgba(0,0,0,.25); cursor:pointer; box-shadow:0 0 0 4px rgba(255,215,97,.18); }
    @media (max-width:576px){ .vol-range{ width:90px; } .vol-btn{ width:34px; height:34px; } }
    .player-btn[disabled]{ opacity:.5; cursor:not-allowed; }
    .np-line{ min-height:1.5rem; font-weight:600; overflow:hidden; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; line-height:1.2; max-height:calc(1.2em * 2); word-break:break-word; }
    .np-marquee{ position:relative; overflow:hidden; white-space:nowrap; }
    .np-marquee::before, .np-marquee::after{ content:""; position:absolute; top:0; bottom:0; width:22px; pointer-events:none; }
    .np-marquee::before{ left:0; background:linear-gradient(90deg, rgba(0,0,0,.6), transparent); }
    .np-marquee::after{ right:0; background:linear-gradient(270deg, rgba(0,0,0,.6), transparent); }
    .np-marquee.marquee span{ display:inline-block; padding-right:2rem; }
    .np-marquee.marquee .np-scroll{ animation: marquee 18s linear infinite; }
    .np-marquee:hover .np-scroll{ animation-play-state: paused; }
    @keyframes marquee{ from{ transform: translateX(0); } to{ transform: translateX(calc(-100% - 2rem)); } }
    @media (prefers-reduced-motion: reduce){ .np-marquee.marquee .np-scroll{ animation: none; } }
    .np-meta{ font-size:.85rem; opacity:.8; }
    .player-body .flex-grow-1{ min-width:0; }
    @media (max-width: 576px){ .np-line{ font-size:.95rem; -webkit-line-clamp:3; max-height:calc(1.2em * 3); } }
    .shake{ animation: shake .6s; }
    @keyframes shake{ 10%, 90%{ transform: translateX(-1px); } 20%, 80%{ transform: translateX(2px); } 30%, 50%, 70%{ transform: translateX(-4px); } 40%, 60%{ transform: translateX(4px); } }

    /* History card */
    .history-card{ background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.14); border-radius:16px; backdrop-filter: blur(6px); padding:16px; }
    .history-controls{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
    .history-controls .form-control, .history-controls .btn{ height:38px; }
    .tz-note{ opacity:.7; font-size:.85rem; }

    /* Accordion (glass) */
    .accordion-glass .accordion-item{ background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.14); border-radius:14px; overflow:hidden; }
    .accordion-glass .accordion-item + .accordion-item{ margin-top:10px; }
    .accordion-glass .accordion-button{ background:transparent; color:#e9f1ff; }
    .accordion-glass .accordion-button:focus{ box-shadow:none; }
    .accordion-glass .accordion-button:not(.collapsed){ color:#ffd761; background:rgba(255,255,255,.03); }
    .accordion-glass .accordion-body{ color:#e9f1ff; }
    .accordion-glass .muted{ color:#cfd8ffcc; }

    /* Producers grid */
    .prod-grid{ display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:12px; }
    .prod-card{ background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.14); border-radius:14px; padding:14px; text-align:center; }
    .prod-card .name{ font-weight:700; }
    .prod-card .bio{ color:#cfd8ffcc; font-size:.95rem; }
    .avatar{ width:96px; height:96px; border-radius:50%; overflow:hidden; margin:0 auto 8px; position:relative; }
    .avatar img{ width:100%; height:100%; object-fit:cover; display:block; }
    .avatar::after{ content:""; position:absolute; inset:-3px; border-radius:50%; border:1px solid rgba(255,255,255,.25); box-shadow:0 0 0 0 rgba(255,215,97,.35); animation: ring 3s infinite; }
    @keyframes ring{ 0%{ box-shadow:0 0 0 0 rgba(255,215,97,.35);} 70%{ box-shadow:0 0 0 10px rgba(255,215,97,0);} 100%{ box-shadow:0 0 0 0 rgba(255,215,97,0);} }

    /* Back to top */
    .back-to-top{ position:fixed; right:18px; bottom:18px; z-index:5; width:44px; height:44px; border-radius:50%; border:1px solid rgba(255,255,255,.25); background:rgba(0,0,0,.4); color:#e9f1ff; display:inline-flex; align-items:center; justify-content:center; opacity:0; visibility:hidden; transition:opacity .2s ease, visibility .2s ease, transform .2s ease; }
    .back-to-top.show{ opacity:1; visibility:visible; transform: translateY(0); }
    .back-to-top:not(.show){ transform: translateY(6px); }
  </style>
</head>
<body>
  <!-- Canvas starfield (Atari-like) -->
  <canvas id="starfieldCanvas" aria-hidden="true"></canvas>

  <!-- Nav -->
  <nav class="navbar navbar-expand-md navbar-dark navbar-custom sticky-top">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html"><i class="fa-solid fa-broadcast-tower me-2"></i> Le Chat Noir</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsMain" aria-controls="navbarsMain" aria-expanded="false" aria-label="Basculer la navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarsMain">
        <ul class="navbar-nav ms-auto mb-2 mb-md-0">
          <li class="nav-item"><a class="nav-link" href="about.html">À propos</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container py-5">
    <header class="text-center mb-4">
      <h1 class="display-6 fw-bold">LE CHAT NOIR — WEBRADIO</h1>
      <p class="text-light-emphasis mt-2">Webradio libre — créations sonores & expérimentations</p>
      <div class="wave-divider"></div>
    </header>

    <section class="row justify-content-center g-4 align-items-start">
      <div class="col-12 col-md-8">
        <div class="cover mb-4">
          <a href="PICS/lcnwebradio.png" target="_blank" rel="noopener" title="Ouvrir l’image en grand">
            <img src="PICS/lcnwebradio.png" alt="Visuel — Le Chat Noir Webradio" loading="lazy"/>
          </a>
        </div>
        <div class="d-flex flex-wrap gap-2 mb-3">
          <span class="badge-tag"><i class="fa-solid fa-tower-broadcast me-2"></i>Écoute 24/7</span>
          <span class="badge-tag"><i class="fa-brands fa-creative-commons me-2"></i>Créations libres</span>
          <span class="badge-tag"><i class="fa-solid fa-ban me-2"></i>Sans SACEM</span>
        </div>
        <!-- Intro text placed above the player -->
        <p class="lead text-light"><strong>Le Chat Noir — Webradio libre</strong></p>
        <p class="text-light">Le Chat Noir est une webradio artisanale, indépendante et sans SACEM.</p>
        <p class="text-light-emphasis"><i class="fa-solid fa-wave-square me-2" aria-hidden="true"></i>Elle diffuse en continu des créations libres : paysages sonores, field recordings, expérimentations radiophoniques, musiques ouvertes, fragiles et archives vivantes. On y écoute des émissions et de la musique de tous horizons, sans discrimination — de la noise à la chanson française, de l’expérimental à la dream pop, etc. Un espace d’écoute lente, entre fiction et réel, où le bruit, la voix et le silence se rencontrent.</p>
        <p class="text-light-emphasis"><i class="fa-solid fa-sliders me-2" aria-hidden="true"></i>Nous n’appliquons aucune compression ni égalisation globale sur les œuvres diffusées, pour respecter au maximum leurs dynamiques et ce qu’elles sont. Si ça va trop fort, il faut baisser le volume ; si ce n’est pas assez fort, il faut simplement l’augmenter.</p>
        <p class="text-light-emphasis"><i class="fa-solid fa-satellite-dish me-2" aria-hidden="true"></i>Tout est fait maison — hébergé, programmé et maintenu localement. Une radio de proximité cosmique, née dans une courée, tournée vers l’espace.</p>
        <div class="d-flex flex-wrap gap-2 mt-3 mb-3">
          <a class="btn btn-outline-light btn-sm" href="index.html"><i class="fa-solid fa-arrow-left me-2"></i>Retour à l’accueil</a>
        </div>
        <!-- Faux player / Now Playing -->
        <div class="player-card mb-4" role="region" aria-label="Lecteur — Le Chat Noir">
          <div class="player-header">
            <div class="onair"><span class="dot" aria-hidden="true"></span><span>ON AIR</span></div>
            <div class="text-light-emphasis small">Flux local (LAN)</div>
          </div>
          <div class="player-body">
            <button id="playBtn" class="player-btn" type="button" aria-label="Lire le flux">
              <i class="fa-solid fa-play"></i>
            </button>
            <audio id="lcnAudio" preload="none" src="http://192.168.1.115:8000/stream" crossorigin="anonymous"></audio>
            <div class="vol-group" role="group" aria-label="Volume">
              <button id="volDown" class="vol-btn" type="button" aria-label="Baisser le volume"><i class="fa-solid fa-volume-low"></i></button>
              <input id="volRange" class="vol-range" type="range" min="0" max="1" step="0.01" value="0.80" aria-label="Régler le volume" />
              <button id="volUp" class="vol-btn" type="button" aria-label="Augmenter le volume"><i class="fa-solid fa-volume-high"></i></button>
            </div>
            <div class="flex-grow-1">
              <div class="np-line" title="Titre en cours">
                <div id="npwrap" class="np-marquee"><span id="np">Chargement…</span></div>
              </div>
              <div class="np-meta text-light-emphasis">Now playing</div>
            </div>
          </div>
        </div>
        <!-- Historique des titres -->
        <section class="history-card mb-4" role="region" aria-label="Historique des titres">
          <div class="d-flex justify-content-between align-items-end flex-wrap gap-2 mb-2">
            <h2 class="h6 m-0"><i class="fa-regular fa-clock me-2"></i>Historique des titres</h2>
            <div class="tz-note text-light-emphasis">Heures affichées en <span id="tzLabel">heure locale</span>.</div>
          </div>
          <div class="history-controls mb-3">
            <div class="input-group" style="max-width: 260px;">
              <span class="input-group-text"><i class="fa-regular fa-calendar"></i></span>
              <input id="histDay" type="date" class="form-control" aria-label="Choisir une date" />
            </div>
            <div class="input-group" style="max-width: 200px;">
              <span class="input-group-text"><i class="fa-regular fa-clock"></i></span>
              <input id="histTime" type="time" class="form-control" aria-label="Choisir une heure (facultatif)" />
            </div>
            <button id="histLoad" class="btn btn-outline-light"><i class="fa-solid fa-magnifying-glass me-2"></i>Rechercher</button>
            <button id="histLatest" class="btn btn-ghost"><i class="fa-solid fa-rotate me-2"></i>Derniers titres</button>
          </div>
          <div class="table-responsive">
            <table id="histTable" class="table table-dark table-striped table-sm align-middle m-0">
              <thead>
                <tr><th style="width:110px;">Date</th><th style="width:100px;">Heure</th><th>Titre</th></tr>
              </thead>
              <tbody id="histBody">
                <tr><td colspan="3" class="text-light-emphasis">Choisis une date ou affiche les derniers titres…</td></tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Programme & Producteur·ices (accordion) -->
        <section class="mb-4">
          <div class="accordion accordion-glass" id="progAccordion">
            <!-- Grille des programmes -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="acc-grid-h">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#acc-grid" aria-expanded="false" aria-controls="acc-grid">
                  <i class="fa-regular fa-calendar-days me-2"></i> Grille des programmes
                </button>
              </h2>
              <div id="acc-grid" class="accordion-collapse collapse" aria-labelledby="acc-grid-h" data-bs-parent="#progAccordion">
                <div class="accordion-body">
                  <p>La grille est <strong>en cours de conception</strong> — on affine les cases, on teste les enchaînements, on règle le souffle entre deux morceaux.</p>
                  <p>Pour l’instant, la station diffuse en <strong>lecture aléatoire</strong> parmi les créations disponibles. C’est brut, c’est vivant — et, honnêtement, <em>c’est fun</em>.</p>
                </div>
              </div>
            </div>
            <!-- Producteur·ices -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="acc-prods-h">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#acc-prods" aria-expanded="false" aria-controls="acc-prods">
                  <i class="fa-solid fa-user-astronaut me-2"></i> Productrices & Producteurs
                </button>
              </h2>
              <div id="acc-prods" class="accordion-collapse collapse" aria-labelledby="acc-prods-h" data-bs-parent="#progAccordion">
                <div class="accordion-body">

                  <div class="prod-grid">
                    <article class="prod-card">
                      <div class="avatar">
                        <img src="PICS/drjohn.jpg" alt="Portrait de Dr. John" loading="lazy" />
                      </div>
                      <div class="name">Dr. John</div>
                      <p class="bio mb-0">Dr. John explore les zones floues entre réalité sonore et fiction radiophonique.</p>
                    </article>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Infos: Contact + Mentions (accordion) -->
        <section class="mb-5">
          <div class="accordion accordion-glass" id="infosAccordion">
            <!-- Contact -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="acc-contact-h">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#acc-contact" aria-expanded="false" aria-controls="acc-contact">
                  <i class="fa-regular fa-envelope me-2"></i> Contact
                </button>
              </h2>
              <div id="acc-contact" class="accordion-collapse collapse" aria-labelledby="acc-contact-h" data-bs-parent="#infosAccordion">
                <div class="accordion-body">
                  <p>Tu veux proposer une émission, un podcast, ta musique, retirer un titre/artiste diffusé, signaler un problème ou simplement poser une question ?</p>
                  <p>Tu peux nous écrire directement ici :</p>
                  <p>
                    <a class="btn btn-outline-light btn-sm" href="mailto:recordingsofthemasters@gmail.com?subject=Le%20Chat%20Noir%20-%20Contact" aria-label="Écrire un email à Le Chat Noir (objet pré-rempli)">
                      <i class="fa-regular fa-envelope me-2"></i>Écrire un message
                    </a>
                  </p>
                  <p class="mb-2">Nous sommes ouvert·es à toutes les propositions d’émission, de mix, de podcast ou de création sonore, à condition que tu détiennes les droits d’auteur sur tout ce que tu proposes. Le Chat Noir ne diffuse que des contenus libres de droits (sans SACEM).</p>
                  <p class="mb-2">Nous ne diffuserons pas de contenus haineux, discriminatoires, fascistes, masculinistes, racistes, LGBTQIA+phobes ou assimilés&nbsp;: la radio reste un espace d’écoute safe.</p>
                  <p class="muted">Nous écoutons tout ce qui nous est envoyé, sans garantie de diffusion.<br>
                  Si tu demandes le retrait d’un morceau, la suppression est faite dès réception du message.<br>
                  Aucune donnée personnelle n’est conservée au-delà du traitement de ta demande.</p>
                  <p class="mb-1">Merci de préciser dans ton message :</p>
                  <ul class="mb-0">
                    <li>le titre ou l’artiste concerné,</li>
                    <li>un lien d’écoute & de téléchargement (si tu proposes une œuvre),</li>
                    <li>et ton nom ou pseudonyme.</li>
                  </ul>
                </div>
              </div>
            </div>
            <!-- Mentions & confidentialité -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="acc-legal-h">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#acc-legal" aria-expanded="false" aria-controls="acc-legal">
                  <i class="fa-regular fa-file-lines me-2"></i> Mentions & confidentialité
                </button>
              </h2>
              <div id="acc-legal" class="accordion-collapse collapse" aria-labelledby="acc-legal-h" data-bs-parent="#infosAccordion">
                <div class="accordion-body">
                  <h3 class="h6">Éditeur du site</h3>
                  <p class="mb-2">Le site Le Chat Noir Radio est édité et maintenu par un particulier, hébergé à titre non commercial sur un serveur personnel.</p>
                  <p>
                    <a class="btn btn-outline-light btn-sm" href="mailto:recordingsofthemasters@gmail.com?subject=Le%20Chat%20Noir%20-%20Contact" aria-label="Écrire un email à Le Chat Noir (objet pré-rempli)">
                      <i class="fa-regular fa-envelope me-2"></i>Écrire un message (éditeur)
                    </a>
                  </p>

                  <h3 class="h6 mt-3">Contenu et diffusion</h3>
                  <p class="mb-2">Tous les morceaux diffusés sont des œuvres libres de droits ou créées par leurs auteur·ices respectif·ves.<br>
                  Aucun contenu soumis à la SACEM n’est diffusé.<br>
                  Si tu constates une erreur ou une diffusion non souhaitée, signale-la par le formulaire de contact.</p>

                  <h3 class="h6 mt-3">Données personnelles</h3>
                  <p class="mb-2">Le site ne trace pas les visiteurs. Les seules données collectées sont celles que tu fournis volontairement (nom, e-mail, message). Elles servent uniquement à répondre à ta demande et ne sont ni stockées ni partagées. Les statistiques d’écoute sont agrégées et anonymes.</p>

                  <h3 class="h6 mt-3">Open source</h3>
                  <p class="mb-2">Une partie du code du site et des scripts de diffusion est publiée sous licence libre. Le dépôt complet est consultable sur GitHub.</p>

                  <h3 class="h6 mt-3">Responsabilité</h3>
                  <p class="mb-0">L’éditeur ne saurait être tenu responsable d’une interruption temporaire du flux, ni de tout dommage indirect lié à l’usage du site ou à la diffusion en ligne.</p>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Back to top floating button -->
        <button id="backToTop" class="back-to-top" aria-label="Remonter en haut"><i class="fa-solid fa-arrow-up"></i></button>
      </div>
    </section>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
  // --- Canvas starfield + UFOs (Atari-like) ---
  (function(){
    const canvas = document.getElementById('starfieldCanvas');
    if(!canvas) return;
    const ctx = canvas.getContext('2d');
    let w,h,stars=[],ufos=[];
    function resize(){
      w = canvas.width  = window.innerWidth  * (window.devicePixelRatio||1);
      h = canvas.height = window.innerHeight * (window.devicePixelRatio||1);
      canvas.style.width='100%'; canvas.style.height='100%';
      const isMobile = window.innerWidth < 700;
      const starCount = isMobile ? 120 : 220;
      const ufoCount  = isMobile ? 2   : 4;
      stars = Array.from({length: starCount}, ()=>({ x:Math.random()*w, y:Math.random()*h, s:Math.random()*(isMobile?1.1:1.5)+0.5, a:Math.random(), d:Math.random()*0.02+0.005 }));
      ufos  = Array.from({length: ufoCount }, ()=>({ x:Math.random()*w, y:Math.random()*h*0.7, ang:Math.random()*Math.PI*2, spd:(Math.random()*0.35+0.12)*(window.devicePixelRatio||1), sc:(Math.random()*0.45+0.6)*(isMobile?0.85:1)}));
    }
    window.addEventListener('resize', resize); resize();
    function drawUFO(u){ ctx.save(); ctx.translate(u.x,u.y); ctx.scale(u.sc,u.sc); ctx.beginPath(); const pts=[[-9,0],[-3,-3],[-2,-6],[2,-6],[3,-3],[9,0],[-9,0],[-3,4],[3,4],[9,0]]; ctx.moveTo(pts[0][0],pts[0][1]); for(let i=1;i<pts.length;i++){ ctx.lineTo(pts[i][0],pts[i][1]); } ctx.closePath(); ctx.fillStyle='#9ecbff'; ctx.fill(); ctx.strokeStyle='rgba(255,255,255,.9)'; ctx.lineWidth=1.2; ctx.stroke(); ctx.restore(); }
    function loop(){ ctx.clearRect(0,0,w,h); for(const s of stars){ s.a += s.d*(Math.random()<0.5?1:-1); if(s.a<0){ s.x=Math.random()*w; s.y=Math.random()*h; s.a=0;} if(s.a>1) s.a=1; ctx.globalAlpha=s.a; ctx.fillStyle='#fff'; const sz = s.s*(window.devicePixelRatio||1); ctx.fillRect(s.x,s.y,sz,sz);} ctx.globalAlpha=1; for(const u of ufos){ u.ang += (Math.random()*0.08 - 0.04); u.x += Math.cos(u.ang)*u.spd; u.y += Math.sin(u.ang)*u.spd*0.6; if(u.x<-60)u.x=w+60; if(u.x>w+60)u.x=-60; if(u.y<-40)u.y=h+40; if(u.y>h+40)u.y=-40; drawUFO(u);} requestAnimationFrame(loop);} loop(); })();
  </script>
  <script>
  // --- Now Playing (placeholder; URL à renseigner) ---
  const NP_URL = 'http://192.168.1.115/nowplaying.json';
  async function refreshNP(){
    try{
      const r = await fetch(NP_URL + '?t=' + Date.now(), {cache:'no-store'});
      if(!r.ok) throw new Error(r.status);
      const np = await r.json();
      const line = `${(np.title||'(sans titre)').trim()}`;
      const wrap = document.getElementById('npwrap');
      const span = document.getElementById('np');
      if(wrap && span){
        // Reset content
        span.textContent = line;
        span.classList.remove('np-scroll');
        // Remove any ghost clone
        const ghost = wrap.querySelector('span.ghost');
        if(ghost) ghost.remove();
        // Measure overflow
        // Force single-line for measurement (np-line already constrains height in CSS)
        wrap.classList.remove('marquee');
        // Next frame to ensure layout updated
        requestAnimationFrame(()=>{
          const needsMarquee = wrap.scrollWidth > wrap.clientWidth + 6; // small tolerance
          if(needsMarquee){
            wrap.classList.add('marquee');
            // Duplicate content for seamless loop
            const clone = document.createElement('span');
            clone.className = 'ghost np-scroll';
            clone.textContent = line;
            wrap.appendChild(clone);
            // Mark original as scrolling too
            span.classList.add('np-scroll');
          }
          // Update title tooltip on the parent line
          const lineEl = wrap.closest('.np-line');
          if(lineEl){ lineEl.setAttribute('title', line); }
        });
      }
    }catch(e){ /* garder l’affichage précédent si indisponible */ }
  }
  refreshNP();
  setInterval(refreshNP, 10000);

  // --- Lecture du flux local (LAN) ---
  (function(){
    const btn = document.getElementById('playBtn');
    const audio = document.getElementById('lcnAudio');
    const volRange = document.getElementById('volRange');
    const volDown  = document.getElementById('volDown');
    const volUp    = document.getElementById('volUp');
    const VOL_STEP = 0.05;

    // Init volume from slider value
    if(volRange){ audio.volume = parseFloat(volRange.value || '0.8'); }

    if(!btn || !audio) return;

    let isPlaying = false;
    function setIcon(){ btn.querySelector('i').className = isPlaying ? 'fa-solid fa-pause' : 'fa-solid fa-play'; }

    btn.addEventListener('click', async ()=>{
      try{
        if(!isPlaying){ await audio.play(); isPlaying = true; btn.setAttribute('aria-label','Mettre en pause'); }
        else { audio.pause(); isPlaying = false; btn.setAttribute('aria-label','Lire le flux'); }
        setIcon();
      }catch(e){
        // Affiche une petite alerte discrète si le flux n’est pas accessible
        console.warn('Lecture impossible:', e);
        btn.classList.add('shake'); // optionnel si on veut un feedback visuel
        setTimeout(()=>btn.classList.remove('shake'), 600);
      }
    });

    audio.addEventListener('playing', ()=>{ isPlaying = true; setIcon(); });
    audio.addEventListener('pause',   ()=>{ isPlaying = false; setIcon(); });
    audio.addEventListener('error',   ()=>{ isPlaying = false; setIcon(); });

    function clamp(v,min,max){ return Math.min(max, Math.max(min,v)); }

    if(volRange){
      volRange.addEventListener('input', ()=>{ audio.volume = clamp(parseFloat(volRange.value||'0.8'), 0, 1); });
    }
    if(volDown){
      volDown.addEventListener('click', ()=>{
        const v = clamp(audio.volume - VOL_STEP, 0, 1);
        audio.volume = v; if(volRange) volRange.value = v.toFixed(2);
      });
    }
    if(volUp){
      volUp.addEventListener('click', ()=>{
        const v = clamp(audio.volume + VOL_STEP, 0, 1);
        audio.volume = v; if(volRange) volRange.value = v.toFixed(2);
      });
    }
  })();
  </script>
  <script>
  // --- Historique des titres ---
  (function(){
    const BASE = 'http://192.168.1.115/history'; // à remplacer par domaine public plus tard
    const dayInput = document.getElementById('histDay');
    const timeInput = document.getElementById('histTime');
    const btnLoad = document.getElementById('histLoad');
    const btnLatest = document.getElementById('histLatest');
    const tbody = document.getElementById('histBody');
    const tzLabel = document.getElementById('tzLabel');
    let autoTimer = null;
    const AUTO_MS = 20000; // 20s
    function startAutoLatest(){
      stopAutoLatest();
      loadLatest();
      autoTimer = setInterval(()=>{ if(!document.hidden) loadLatest(); }, AUTO_MS);
    }
    function stopAutoLatest(){ if(autoTimer){ clearInterval(autoTimer); autoTimer = null; } }

    // Affiche le fuseau local (ex: Europe/Paris)
    try{ tzLabel.textContent = Intl.DateTimeFormat().resolvedOptions().timeZone || 'heure locale'; }catch(_){ /* noop */ }

    // Préremplir la date avec aujourd'hui (local)
    const todayLocal = new Date();
    const yyyy = todayLocal.getFullYear();
    const mm = String(todayLocal.getMonth()+1).padStart(2,'0');
    const dd = String(todayLocal.getDate()).padStart(2,'0');
    if(dayInput) dayInput.value = `${yyyy}-${mm}-${dd}`;

    document.addEventListener('visibilitychange', ()=>{
      if(document.hidden){ stopAutoLatest(); }
      else if(!autoTimer){ startAutoLatest(); }
    });

    function toLocalHHMM(iso){
      const d = new Date(iso);
      if(isNaN(d)) return '';
      return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }
    function toLocalDateDDMMYYYY(iso){
      const d = new Date(iso);
      if(isNaN(d)) return '';
      const dd = String(d.getDate()).padStart(2,'0');
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const yyyy = d.getFullYear();
      return `${dd}/${mm}/${yyyy}`;
    }

    function parseCSV(text){
      const lines = text.trim().split('\n');
      const data = [];
      for(let i=1;i<lines.length;i++){ // skip header
        const line = lines[i];
        const cols = [];
        let cur = '', inside = false;
        for(let j=0;j<line.length;j++){
          const c = line[j];
          if(c==='"'){ inside = !inside; continue; }
          if(c===',' && !inside){ cols.push(cur); cur=''; } else { cur+=c; }
        }
        cols.push(cur);
        const [ts_iso, , artist, title, album, year] = cols;
        data.push({ ts_iso, artist, title, album, year });
      }
      return data;
    }

    function renderRows(rows){
      if(!rows || !rows.length){
        tbody.innerHTML = `<tr><td colspan="3" class="text-light-emphasis">Aucun titre pour cette date.</td></tr>`;
        return;
      }
      const html = rows.map(r=>{
        const hhmm = toLocalHHMM(r.ts_iso);
        const safe = s=> (s||'').replace(/</g,'&lt;');
        const dmy = toLocalDateDDMMYYYY(r.ts_iso);
        return `<tr><td>${dmy}</td><td>${hhmm}</td><td>${safe(r.title)}</td></tr>`;
      }).join('');
      tbody.innerHTML = html || `<tr><td colspan="3" class="text-light-emphasis">Aucun titre pour cette date.</td></tr>`;
    }

    async function loadDay(ymd){
      if(!ymd) return;
      const d = new Date(ymd + 'T00:00:00'); // local midnight
      const Y = d.getFullYear();
      const M = String(d.getMonth()+1).padStart(2,'0');
      const D = String(d.getDate()).padStart(2,'0');
      const url = `${BASE}/${Y}/${M}/${Y}-${M}-${D}.csv`;
      tbody.innerHTML = `<tr><td colspan="3" class="text-light-emphasis">Chargement…</td></tr>`;
      try{
        const res = await fetch(url, {cache:'no-store'});
        if(!res.ok){ renderRows([]); return; }
        const csv = await res.text();
        let rows = parseCSV(csv);
        rows = rows.filter(r => !(r.artist === 'Inconnu·e' && r.title === 'Inconnu·e — (sans titre)'));
        // Tri chronologique croissant
        rows.sort((a,b)=> new Date(a.ts_iso) - new Date(b.ts_iso));
        // Si une heure est fournie, on met la ligne la plus proche en haut en scroll (optionnel)
        if(timeInput && timeInput.value){
          const [hh,mm] = timeInput.value.split(':').map(Number);
          const ref = new Date(ymd + `T${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}:00`);
          rows.sort((a,b)=> Math.abs(new Date(a.ts_iso)-ref) - Math.abs(new Date(b.ts_iso)-ref));
        }
        renderRows(rows);
      }catch(e){ renderRows([]); }
    }

    async function loadLatest(){
      // Charge aujourd'hui et n'affiche que les 10 derniers titres
      const ymd = dayInput?.value; if(!ymd) return;
      const d = new Date(ymd + 'T00:00:00');
      const Y = d.getFullYear();
      const M = String(d.getMonth()+1).padStart(2,'0');
      const D = String(d.getDate()).padStart(2,'0');
      const url = `${BASE}/${Y}/${M}/${Y}-${M}-${D}.csv`;
      tbody.innerHTML = `<tr><td colspan="3" class="text-light-emphasis">Chargement…</td></tr>`;
      try{
        const res = await fetch(url, {cache:'no-store'});
        if(!res.ok){ renderRows([]); return; }
        const csv = await res.text();
        let rows = parseCSV(csv);
        rows = rows.filter(r => !(r.artist === 'Inconnu·e' && r.title === 'Inconnu·e — (sans titre)'));
        // Trier et garder les 10 plus récents
        rows.sort((a,b)=> new Date(b.ts_iso) - new Date(a.ts_iso));
        rows = rows.slice(0, 10);
        renderRows(rows);
      }catch(e){ renderRows([]); }
    }

    if(btnLoad){ btnLoad.addEventListener('click', ()=>{ stopAutoLatest(); loadDay(dayInput.value); }); }
    if(btnLatest){ btnLatest.addEventListener('click', startAutoLatest); }

    // Charger par défaut les derniers titres du jour + activer l’auto-refresh
    startAutoLatest();
  })();
  </script>
</body>
  <script>
    (function(){
      const btn = document.getElementById('backToTop');
      if(!btn) return;
      function onScroll(){
        if(window.scrollY > 400) btn.classList.add('show'); else btn.classList.remove('show');
      }
      window.addEventListener('scroll', onScroll, {passive:true});
      onScroll();
      btn.addEventListener('click', ()=>{ window.scrollTo({top:0, behavior:'smooth'}); });
    })();
  </script>
</html>